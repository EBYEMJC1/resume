<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Interactive Resume Builder</title>
<style>
        /* --- Builder Layout Styles --- */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            line-height: 1.2; /* Slightly increased for form readability */
            font-size: 14px; /* Increased for form readability */
            display: flex; /* Use flexbox for side-by-side layout */
            min-height: 100vh; /* Ensure full height */
        }
        .builder-container {
            display: flex;
            width: 100%;
            max-width: 1400px; /* Allow more width for side-by-side */
            margin: 0 auto;
            padding: 10px;
            box-sizing: border-box;
        }
        .input-area {
            width: 40%; /* Allocate more width for input forms */
            padding-right: 20px;
            overflow-y: auto; /* Allow scrolling in input area */
            box-sizing: border-box;
            max-height: calc(100vh - 20px); /* Prevent input area from becoming too tall */
        }
        .resume-area {
            width: 60%; /* Allocate width for resume preview */
            border-left: 1px solid #ccc;
            padding-left: 20px;
            box-sizing: border-box;
            overflow-y: auto; /* Allow scrolling in resume area */
            max-height: calc(100vh - 20px); /* Match height */
        }

        /* Style for input sections */
        .input-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .input-section h3 {
            margin-top: 0;
            margin-bottom: 10px;
            border-bottom: 1px dashed #ccc;
            padding-bottom: 5px;
        }
         .input-section label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 12px; /* Smaller label font */
        }
         .input-section input[type="text"],
        .input-section input[type="email"],
        .input-section input[type="tel"],
        .input-section textarea,
         .input-section select {
            width: calc(100% - 12px); /* Adjust width for padding */
            padding: 5px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 3px;
            font-size: 12px;
        }
        .input-section textarea {
            resize: vertical;
        }

        .input-section button {
            display: inline-block;
            background-color: #007bff;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 5px;
            margin-right: 5px; /* Space between buttons */
        }
        .input-section button:hover {
            background-color: #0056b3;
        }
         .input-section .remove-button {
             background-color: #dc3545;
             margin-left: 5px;
         }
         .input-section .remove-button:hover {
             background-color: #c82333;
         }
         .input-section .cancel-button {
            background-color: #6c757d;
         }
         .input-section .cancel-button:hover {
            background-color: #5a6268;
         }


        .bullet-inputs {
            margin-top: 10px;
            padding: 10px;
            border: 1px dashed #ccc;
            border-radius: 3px;
            background-color: #fff;
        }
         .bullet-inputs label {
             font-weight: normal;
         }
        .bullet-inputs input[type="text"] {
            margin-bottom: 5px;
        }
         .bullet-item { /* Wrapper for input + remove button */
             display: flex;
             align-items: center;
             margin-bottom: 5px;
         }
         .bullet-item input {
             flex-grow: 1; /* Input takes available space */
             margin-bottom: 0 !important; /* Override default margin */
             margin-right: 5px;
         }


        .bullet-inputs .add-bullet-button {
            background-color: #28a745;
            margin-right: 5px;
        }
         .bullet-inputs .add-bullet-button:hover {
             background-color: #218838;
         }
         .bullet-inputs .remove-bullet-button {
              background-color: #6c757d;
              flex-shrink: 0; /* Don't shrink button */
              padding: 2px 5px;
              font-size: 10px;
              height: 24px;
         }
         .bullet-inputs .remove-bullet-button:hover {
              background-color: #5a6268;
         }

        .bullet-guide {
            font-size: 10px;
            color: #555;
            margin-bottom: 10px;
        }

        #section-remove-list {
            list-style: none;
            padding: 0;
            margin-top: 10px;
        }
        #section-remove-list li {
            margin-bottom: 5px;
            padding: 5px;
            border: 1px solid #eee;
            background-color: #fff;
            display: flex;
            justify-content: space-between;
            align-items: center;
             font-size: 12px;
        }
         #section-remove-list li .section-name {
             flex-grow: 1;
         }
         #section-remove-list li button {
             margin-top: 0;
             padding: 2px 8px;
             margin-left: 3px;
         }
         .order-button {
            font-size: 10px;
            padding: 2px 5px !important;
            line-height: 1;
         }


         .date-required label::after {
             content: "*";
             color: red;
             margin-left: 2px;
         }
         .date-guide {
             font-size: 10px;
             color: #555;
             margin-top: -8px; /* Pull it closer to the input */
             margin-bottom: 10px;
         }
          .bullet-length-feedback {
              font-size: 10px;
              color: #d9534f; /* Reddish color for warning */
              margin-top: -8px;
              margin-bottom: 8px;
              display: none; /* Hide by default */
          }
           .bullet-length-feedback.show {
               display: block;
           }


        /* --- Resume Display Styles (Optimized for tightness) --- */
        .resume-area .container {
            max-width: 100%; /* Use full width of the resume-area */
            margin: 0; /* Remove auto margin */
            padding: 0; /* Remove padding, it's on the resume-area */
            font-size: 11px; /* Keep original resume font size */
            line-height: 1.1; /* Keep tight line height */
            position: relative; /* For positioning entry controls */
        }
         /* Base styles for dynamically added sections */
        .resume-section {
            margin-top: 10px; /* Consistent spacing between sections */
            position: relative;
        }
        .resume-section .section-title {
            font-weight: bold;
            font-size: 13px;
            margin-top: 0; /* Margin handled by .resume-section */
            border-bottom: 1px solid #000;
            padding-bottom: 2px;
            margin-bottom: 4px; /* Space between title and content */
        }
        .resume-area .header {
            text-align: center;
            margin-bottom: 6px;
        }
        .resume-area .header h1 {
            margin: 0;
            font-size: 16px;
        }
        .resume-area .header p {
            margin: 1px 0;
            font-size: 11px;
        }

        /* Styles specific to content types within sections */
         .resume-section .section-content .job-entry,
         .resume-section .section-content .list-entry-item { /* Wrapper for structured entries and list items */
            margin-top: 8px;
            position: relative; /* For absolute positioning of controls */
            padding-right: 55px; /* Space for controls */
         }
         .resume-section .section-content .job-entry:first-child,
         .resume-section .section-content .list-entry-item:first-child {
             margin-top: 0;
         }
         .entry-controls {
            position: absolute;
            top: 0;
            right: 0;
            display: flex;
            gap: 3px;
         }
         .entry-control-button {
            background: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 3px;
            cursor: pointer;
            font-size: 10px;
            padding: 1px 3px;
            line-height: 1;
         }
         .entry-control-button:hover {
            background: #e0e0e0;
         }


         .resume-section .section-content .job-title { /* Education/Experience Structure */
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            margin-bottom: 0;
            margin-top: 0; /* Margin moved to .job-entry wrapper */
        }
        .resume-section .section-content .location { /* Education/Experience Structure */
            font-style: italic;
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            margin-top: 0;
            margin-bottom: 2px;
        }
        .resume-section .section-content ul { /* Experience/List Structure */
            list-style-type: disc;
            margin-left: 10px;
            font-size: 11px;
            padding-left: 5px;
            margin-top: 0;
            margin-bottom: 0;
        }
        .resume-section .section-content li { /* List items */
             margin-bottom: 1px;
             position: relative; /* For bullet controls */
             padding-right: 15px; /* Space for bullet remove 'x' */
        }
        .resume-section .section-content li:hover .bullet-remove-btn {
            display: inline;
        }
        .resume-section .section-content li .bullet-text:hover {
            background-color: #f0f8ff; /* Light blue on hover to indicate clickable for edit */
            cursor: pointer;
        }

        .bullet-remove-btn {
            position: absolute;
            top: 0;
            right: 0;
            font-size: 10px;
            color: #aaa;
            cursor: pointer;
            padding: 0 2px;
            display: none; /* Hidden by default, shown on li hover */
            line-height: 1;
        }
        .bullet-remove-btn:hover {
            color: red;
        }

        .resume-section .section-content li:last-child {
            margin-bottom: 0;
        }
        .resume-section .section-content p { /* Skills/Paragraph Structure */
            margin: 1px 0;
            margin-top: 3px; /* Space after title */
        }


         /* --- Print Styles --- */
         @media print {
             body {
                 font-size: 10px; /* Slightly smaller base font for print */
                 line-height: 1; /* Even tighter line height for print */
                 display: block; /* Disable flexbox layout for printing */
             }
             .builder-container {
                 display: block; /* Disable flexbox */
                 width: 100%;
                 max-width: 100%;
                 padding: 0;
                 margin: 0;
             }
             .input-area {
                 display: none; /* Hide the input forms when printing */
             }
             .resume-area {
                 width: 100%; /* Resume takes full width */
                 border-left: none;
                 padding-left: 0;
                 overflow-y: visible; /* Disable scrolling */
             }
             .resume-area .container {
                 font-size: 10px; /* Apply smaller font size within resume content */
                 line-height: 1; /* Apply tighter line height within resume content */
             }
             .entry-controls, .bullet-remove-btn { display: none !important; } /* Hide edit/remove controls in print */
             .resume-section .section-content .job-entry,
             .resume-section .section-content .list-entry-item,
             .resume-section .section-content li {
                padding-right: 0 !important; /* Remove padding for controls in print */
             }


             /* Re-apply tighter margins/padding for print */
             .resume-area .header { margin-bottom: 4px; }
             .resume-area .header p { margin: 0; }

             .resume-section { margin-top: 8px; } /* Tighter section spacing */
             .resume-section .section-title { margin-bottom: 2px; padding-bottom: 1px;}

             .resume-section .section-content .job-entry { margin-top: 6px;} /* Tighter space between structured entries */
             .resume-section .section-content .job-entry:first-child { margin-top: 0;}

             .resume-section .section-content .job-title { margin-top: 2px; margin-bottom: 0; }
             .resume-section .section-content .location { margin-top: 0; margin-bottom: 1px; }
             .resume-section .section-content ul { margin-left: 8px; padding-left: 4px; margin-top: 0; margin-bottom: 0; }
             .resume-section .section-content li { margin-bottom: 0; } /* Remove space between list items */
             .resume-section .section-content p { margin: 0; margin-top: 2px;}


             /* Ensure elements don't break across pages where possible */
             .resume-section, .resume-section .section-content .job-entry {
                 page-break-inside: avoid; /* Avoid breaking inside these blocks if possible */
             }
         }

    </style>
</head>
<body>
<div class="builder-container">
<div class="input-area">
<h2>Resume Builder</h2>
<div class="input-section">
<h3>Header Info</h3>
<label for="name">Name:</label><input id="name" placeholder="Your Name" type="text"/>
<label for="address">Address:</label><input id="address" placeholder="City, State Zip" type="text"/>
<label for="email">Email:</label><input id="email" placeholder="email@example.com" type="email"/>
<label for="phone">Phone:</label><input id="phone" placeholder="(XXX) XXX-XXXX" type="tel"/>
<label for="linkedin">LinkedIn URL:</label><input id="linkedin" placeholder="https://linkedin.com/in/yourprofile" type="text"/>
<button onclick="updateHeader()">Update Header</button>
<div>
    <label style="font-size: 12px; margin-top: 8px;">
        <input type="checkbox" id="toggleHeader" checked onchange="toggleHeaderVisibility()"> Show Header
    </label>
    </div></div>
<div class="input-section">
<h3>Section Management</h3>
<label for="new-section-title">New Section Title:</label>
<input id="new-section-title" placeholder="e.g. Projects, Awards" type="text"/>
<label for="new-section-type">Section Type:</label>
<select id="new-section-type">
<option value="structured-entry">Structured Entry (Like Experience)</option>
<option value="list-item">List Item (Like Extracurricular)</option>
<option value="paragraph">Paragraph (Like Skills)</option>
<option value="education-entry">Education Entry</option>
</select>
<button onclick="addSection()">Add New Section</button>
<h4>Manage Sections</h4>
<ul id="section-remove-list">
<!-- Removable sections will be listed here by JS -->
</ul>
</div>
<div class="input-section" id="add-education-entry-section">
<h3>Add Education Entry</h3>
<label for="edu-section-select">Select Section:</label>
<select class="section-select" id="edu-section-select"></select>
<label for="edu-degree">Degree:</label><input id="edu-degree" placeholder="e.g. Bachelor of Science in Biology" type="text"/>
<label for="edu-institution">Institution:</label><input id="edu-institution" placeholder="e.g. California State University, Fullerton" type="text"/>
<label class="date-required" for="edu-date">End Date:</label><input id="edu-date" placeholder="e.g. May 2025, 2023" type="text"/>
<p class="date-guide">Required for sorting. Use format "Month YYYY" or "YYYY".</p>
<label for="edu-gpa">GPA:</label><input id="edu-gpa" placeholder="e.g. 3.45" type="text"/>
<label for="edu-expected">Additional Line (Optional):</label><input id="edu-expected" placeholder="e.g. Expected Graduation: May 2025" type="text"/>
<button id="edu-submit-button" onclick="addEducationEntryForm()">Add Entry</button>
<button id="edu-cancel-button" class="cancel-button" onclick="cancelEdit('education')" style="display:none;">Cancel</button>
</div>
<div class="input-section" id="add-skills-section">
<h3>Add/Set Paragraph Content</h3>
<label for="para-section-select">Select Section:</label>
<select class="section-select" id="para-section-select"></select>
<label for="skills-content">Paragraph Content:</label>
<textarea id="skills-content" placeholder="Comma-separated list of skills." rows="3"></textarea>
<p style="font-size: 10px; color:#555; margin-top: 5px;">Paragraph sections are not sorted by date.</p>
<button onclick="setParagraphContentForm()">Set Content</button>
</div>
<div class="input-section" id="add-structured-entry-section">
<h3>Add Structured Entry (e.g., Experience, Projects)</h3>
<label for="structured-section-select">Select Section:</label>
<select class="section-select" id="structured-section-select"></select>
<label for="structured-position">Position/Title:</label><input id="structured-position" placeholder="e.g. Crew" type="text"/>
<label for="structured-company">Company:</label><input id="structured-company" placeholder="e.g. Chipotle" type="text"/>
<label for="structured-location">Location:</label><input id="structured-location" placeholder="e.g. City, State" type="text"/>
<label class="date-required" for="structured-dates">Dates:</label><input id="structured-dates" placeholder="e.g. Aug 2023 - Present, June 2022 - Aug 2022, 2021" type="text"/>
<p class="date-guide">Required for sorting. Use format "Mon YYYY - Mon YYYY", "YYYY - YYYY", "Month YYYY", or "YYYY".</p>
<div class="bullet-inputs" id="structured-bullets">
<label>Details/Bullets:</label>
<div class="bullet-guide">
                         Use **text** for bolding.
                         <br/>Write achievement-oriented bullets starting with action verbs.
                         <br/>Include quantifiable results (numbers, percentages) where possible.
                          <br/>Consider the STAR method (Situation, Task, Action, Result) or How-What-Why.
                         <br/>Keep bullets concise (ideally 1-2 lines).
                         <br/>Click "Add Another Bullet" for more lines.
                     </div>
<div class="bullet-item">
<input class="bullet-input" placeholder="e.g. Ensured high order accuracy by implementing a step-by-step confirmation process..." type="text"/>
<button class="remove-bullet-button" onclick="removeBulletItem(this)" type="button">x</button>
</div>
<div class="bullet-item">
<input class="bullet-input" placeholder="e.g. Developed a decision tree model using **scikit-learn**..." type="text"/>
<button class="remove-bullet-button" onclick="removeBulletItem(this)" type="button">x</button>
</div>
<p class="bullet-length-feedback"></p> <!-- Feedback message -->
</div>
<button class="add-bullet-button" onclick="addBulletInput('structured-bullets')" type="button">Add Another Bullet</button>
<button id="structured-submit-button" onclick="addStructuredEntryForm()">Add Entry</button>
<button id="structured-cancel-button" class="cancel-button" onclick="cancelEdit('structured')" style="display:none;">Cancel</button>
</div>
<div class="input-section" id="add-list-item-section">
<h3>Add List Item (e.g., Activities, Awards)</h3>
<label for="list-section-select">Select Section:</label>
<select class="section-select" id="list-section-select"></select>
<label class="date-required" for="list-item-text">List Item Text:</label>
<textarea id="list-item-text" placeholder="e.g., STEM Advantage Scholar | January 2022 – Present" rows="2"></textarea>
<p class="date-guide">
                     Required for sorting. Include a date in the text (e.g., Jan 2022, 2023) using formats like "Month YYYY", "YYYY", or "Mon YYYY – Mon YYYY".
                     <br/>Use **text** for bolding.
                 </p>
<button id="list-submit-button" onclick="addListItemForm()">Add Item</button>
<button id="list-cancel-button" class="cancel-button" onclick="cancelEdit('list')" style="display:none;">Cancel</button>
</div>
<div class="input-section">
<h3>Reset/Clear</h3>
<p style="font-size: 10px; color:#555;">"Clear All Dynamic Content" removes all entries but keeps the initial sections. "Reset Builder" clears everything and reloads the page with defaults.</p>
<button onclick="clearResumeContent()">Clear All Entries</button>
<button onclick="location.reload()">Reset Builder</button>
</div>
</div>
<div class="resume-area">
<!-- The Resume content will be built here -->
<div class="container">
<div class="header" id="resume-header">
<h1 id="resume-name"></h1>
<p><span id="resume-contact"></span></p>
<p><a href="#" id="resume-linkedin"></a></p>
</div>
<!-- Sections will be dynamically added here -->
<div id="resume-sections">
<!-- Dynamic sections go here -->
</div>
</div>
</div>
</div>
<script>
        // Data structure to hold defined sections
        let dynamicSections = [];

        // Store content data separately to avoid losing it when re-rendering structure
        let resumeContentData = {
             header: {},
             sections: {} // Store entries per section id
        };

        let editingContext = null; // { sectionId, entryIndex, type }

        // --- Helper Functions ---

        function processBolding(text) {
            if (typeof text !== 'string') return text;
            return text.replace(/\*\*(.*?)\*\*/gi, '<strong>$1</strong>');
        }

        function parseDateForSorting(dateStr) {
            if (!dateStr) return null;
            if (dateStr.toLowerCase().includes("present")) {
                return new Date(9999, 0, 1);
            }
            const fullRangeMatch = dateStr.match(/([A-Za-z]+ \d{4})\s*[-–]\s*([A-Za-z]+ \d{4})/);
            if (fullRangeMatch) {
                const end = new Date(fullRangeMatch[2]);
                if (!isNaN(end.getTime())) return end;
            }
            const yearRange = dateStr.match(/(\d{4})\s*[-–]\s*(\d{4})/);
            if (yearRange) {
                return new Date(parseInt(yearRange[2]), 11, 31);
            }
            const monthYear = dateStr.match(/([A-Za-z]+)\s+(\d{4})/);
            if (monthYear) {
                const date = new Date(`${monthYear[1]} 1, ${monthYear[2]}`);
                if (!isNaN(date.getTime())) return date;
            }
            const yearOnly = dateStr.match(/^(\d{4})$/);
            if (yearOnly) {
                return new Date(parseInt(yearOnly[1]), 11, 31);
            }
            const genericParse = new Date(dateStr);
            if (!isNaN(genericParse.getTime()) && genericParse.getFullYear() > 1900 && genericParse.getFullYear() < 3000) {
                 console.warn(`Date: "${dateStr}" was parsed generically.`);
                 return genericParse;
            }
            console.warn(`Could not parse date for sorting: "${dateStr}".`);
            return null;
        }

        function checkBulletLength(inputElement) {
             const maxLength = 180;
             const feedbackElement = inputElement.closest('.bullet-inputs').querySelector('.bullet-length-feedback');
             if (!feedbackElement) return;

             if (inputElement.value.length > maxLength) {
                 feedbackElement.textContent = `Bullet is quite long (${inputElement.value.length} chars). Consider breaking it.`;
                 feedbackElement.classList.add('show');
             } else {
                  const allInputs = inputElement.closest('.bullet-inputs').querySelectorAll('.bullet-input');
                  let anyTooLong = false;
                  allInputs.forEach(input => { if (input.value.length > maxLength) anyTooLong = true; });
                  if (!anyTooLong) feedbackElement.classList.remove('show');
                  else {
                       feedbackElement.textContent = `Some bullets are long. Consider breaking them.`;
                       feedbackElement.classList.add('show');
                  }
             }
        }

        // --- Resume Rendering ---
        function renderResumeSections() {
            const resumeSectionsDiv = document.getElementById('resume-sections');
            resumeSectionsDiv.innerHTML = '';

            dynamicSections.forEach(section => {
                const sectionDiv = document.createElement('div');
                sectionDiv.classList.add('resume-section');
                sectionDiv.id = `resume-section-${section.id}`;

                const titleDiv = document.createElement('div');
                titleDiv.classList.add('section-title');
                titleDiv.textContent = section.title;

                const contentDiv = document.createElement('div');
                contentDiv.classList.add('section-content');
                contentDiv.id = `content-${section.id}`;

                 if (section.type === 'list-item') {
                     const ul = document.createElement('ul');
                     contentDiv.appendChild(ul);
                 }

                sectionDiv.appendChild(titleDiv);
                sectionDiv.appendChild(contentDiv);
                resumeSectionsDiv.appendChild(sectionDiv);
            });
            populateResumeContent();
        }

        function populateSectionDropdowns() {
            const sectionSelects = document.querySelectorAll('.section-select');
            sectionSelects.forEach(select => {
                const currentSelectedId = select.value;
                select.innerHTML = '';
                let relevantSections = [];
                if (select.id === 'edu-section-select') relevantSections = dynamicSections.filter(s => s.type === 'education-entry');
                else if (select.id === 'para-section-select') relevantSections = dynamicSections.filter(s => s.type === 'paragraph');
                else if (select.id === 'structured-section-select') relevantSections = dynamicSections.filter(s => s.type === 'structured-entry');
                else if (select.id === 'list-section-select') relevantSections = dynamicSections.filter(s => s.type === 'list-item');

                if (relevantSections.length === 0) {
                    select.innerHTML = '<option value="">No sections available</option>';
                    select.disabled = true;
                } else {
                    select.disabled = false;
                    relevantSections.forEach(section => {
                        const option = document.createElement('option');
                        option.value = section.id;
                        option.textContent = section.title;
                        select.appendChild(option);
                    });
                    if (currentSelectedId && relevantSections.some(s => s.id === currentSelectedId)) {
                        select.value = currentSelectedId;
                    } else {
                        select.value = relevantSections[0]?.id || '';
                    }
                }
            });
        }

        // --- Section Management (Add/Remove/Reorder) ---
        function addSection() {
            const titleInput = document.getElementById('new-section-title');
            const typeSelect = document.getElementById('new-section-type');
            const title = titleInput.value.trim();
            const type = typeSelect.value;
            if (!title) { alert("Please enter a section title."); return; }

            const baseId = title.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');
            let sectionId = baseId || `new-section-${Date.now()}`;
            let counter = 1;
            while (dynamicSections.some(s => s.id === sectionId)) {
                sectionId = `${baseId}-${counter++}`;
                if (counter > 100) { sectionId = `section-${Date.now()}`; break; }
            }

            dynamicSections.push({ id: sectionId, title: title, type: type });
            resumeContentData.sections[sectionId] = [];
            renderResumeSections();
            populateSectionDropdowns();
            renderSectionRemovalList();
            titleInput.value = '';
        }

        function renderSectionRemovalList() {
            const removeList = document.getElementById('section-remove-list');
            removeList.innerHTML = '';
            dynamicSections.forEach((section, index) => {
                const li = document.createElement('li');
                const nameSpan = document.createElement('span');
                nameSpan.classList.add('section-name');
                nameSpan.textContent = section.title;
                li.appendChild(nameSpan);

                const controlsDiv = document.createElement('div');

                const upButton = document.createElement('button');
                upButton.classList.add('order-button');
                upButton.innerHTML = '&#9650;'; // Up arrow
                upButton.onclick = () => moveSection(section.id, 'up');
                upButton.disabled = index === 0;
                controlsDiv.appendChild(upButton);

                const downButton = document.createElement('button');
                downButton.classList.add('order-button');
                downButton.innerHTML = '&#9660;'; // Down arrow
                downButton.onclick = () => moveSection(section.id, 'down');
                downButton.disabled = index === dynamicSections.length - 1;
                controlsDiv.appendChild(downButton);

                const removeButton = document.createElement('button');
                removeButton.classList.add('remove-button');
                removeButton.textContent = 'Remove';
                removeButton.type = 'button';
                removeButton.onclick = () => removeSection(section.id);
                controlsDiv.appendChild(removeButton);

                li.appendChild(controlsDiv);
                removeList.appendChild(li);
            });
        }

        function moveSection(sectionId, direction) {
            const index = dynamicSections.findIndex(s => s.id === sectionId);
            if (index === -1) return;

            if (direction === 'up' && index > 0) {
                [dynamicSections[index], dynamicSections[index - 1]] = [dynamicSections[index - 1], dynamicSections[index]];
            } else if (direction === 'down' && index < dynamicSections.length - 1) {
                [dynamicSections[index], dynamicSections[index + 1]] = [dynamicSections[index + 1], dynamicSections[index]];
            }
            renderResumeSections(); // Re-renders resume in new order
            renderSectionRemovalList(); // Re-renders control list with updated arrow states
        }

        function removeSection(id) {
            const index = dynamicSections.findIndex(section => section.id === id);
            if (index !== -1) {
                const isInitialSection = ['education', 'technical-skills', 'experience', 'extracurricular'].includes(id);
                if (isInitialSection && !confirm(`Are you sure you want to remove the "${dynamicSections[index].title}" section? This cannot be undone.`)) {
                    return;
                }
                dynamicSections.splice(index, 1);
                delete resumeContentData.sections[id];
                renderResumeSections();
                populateSectionDropdowns();
                renderSectionRemovalList();
            }
        }

        // --- Editing State Management ---
        function setFormMode(formType, isEditing) {
            const submitButton = document.getElementById(`${formType}-submit-button`);
            const cancelButton = document.getElementById(`${formType}-cancel-button`);

            if (submitButton) submitButton.textContent = isEditing ? `Update ${formType === 'list' ? 'Item' : 'Entry'}` : `Add ${formType === 'list' ? 'Item' : 'Entry'}`;
            if (cancelButton) cancelButton.style.display = isEditing ? 'inline-block' : 'none';
        }

        function clearForm(formType) {
            if (formType === 'education') {
                ['edu-degree', 'edu-institution', 'edu-date', 'edu-gpa', 'edu-expected'].forEach(id => document.getElementById(id).value = '');
            } else if (formType === 'structured') {
                ['structured-position', 'structured-company', 'structured-location', 'structured-dates'].forEach(id => document.getElementById(id).value = '');
                const bulletsContainer = document.getElementById('structured-bullets');
                bulletsContainer.innerHTML = `<label>Details/Bullets:</label><div class="bullet-guide">...</div><div class="bullet-item"><input type="text" class="bullet-input" placeholder="Enter bullet point"><button class="remove-bullet-button" type="button" onclick="removeBulletItem(this)">x</button></div><p class="bullet-length-feedback"></p>`;
                // Re-add guide text if you have a standard one, or simplify. The original example was verbose.
                bulletsContainer.querySelector('.bullet-guide').innerHTML = `Use **text** for bolding.<br>... (shortened for brevity)`;
                bulletsContainer.querySelector('.bullet-input').addEventListener('input', function() { checkBulletLength(this); });

            } else if (formType === 'list') {
                document.getElementById('list-item-text').value = '';
            }
        }

        function cancelEdit(formType) {
            editingContext = null;
            setFormMode(formType, false);
            clearForm(formType);
        }

        // --- Content Management (Add/Edit/Remove Entries & Bullets) ---
        function addEducationEntry(sectionId, data) {
            const section = dynamicSections.find(s => s.id === sectionId);
            if (!section || section.type !== 'education-entry') return;
            const sortDate = parseDateForSorting(data.date);
            if (!sortDate && data.date) { // Only alert if date was provided but couldn't be parsed
                alert(`Education entry date "${data.date}" could not be parsed for sorting. Entry will be added but may not sort correctly.`);
            }
            data.sortDate = sortDate || new Date(0); // Fallback for unsortable, puts at end/start depending on sort order

            if (!resumeContentData.sections[sectionId]) resumeContentData.sections[sectionId] = [];

            if (editingContext && editingContext.sectionId === sectionId && editingContext.type === 'education-entry') {
                resumeContentData.sections[sectionId][editingContext.entryIndex] = data;
            } else {
                resumeContentData.sections[sectionId].push(data);
            }
            populateResumeContent();
            return true; // Indicate success
        }

        function addEducationEntryForm() {
            const sectionId = document.getElementById('edu-section-select').value;
            if (!sectionId) { alert("Please select a section."); return; }
            const data = {
                degree: document.getElementById('edu-degree').value,
                institution: document.getElementById('edu-institution').value,
                date: document.getElementById('edu-date').value,
                gpa: document.getElementById('edu-gpa').value,
                expected: document.getElementById('edu-expected').value
            };
            if (!data.degree || !data.institution || !data.date) {
                alert("Please fill out Degree, Institution, and End Date."); return;
            }
            if (addEducationEntry(sectionId, data)) {
                cancelEdit('education'); // Clears form and resets edit mode
            }
        }

        function setParagraphContent(sectionId, content) {
            const section = dynamicSections.find(s => s.id === sectionId);
            if (!section || section.type !== 'paragraph') return;
            resumeContentData.sections[sectionId] = [content];
            populateResumeContent();
        }
        function setParagraphContentForm() {
            const sectionId = document.getElementById('para-section-select').value;
            if (!sectionId) { alert("Please select a section."); return; }
            setParagraphContent(sectionId, document.getElementById('skills-content').value);
        }

        function addStructuredEntry(sectionId, data) {
            const section = dynamicSections.find(s => s.id === sectionId);
            if (!section || section.type !== 'structured-entry') return;
            const sortDate = parseDateForSorting(data.dates);
             if (!sortDate && data.dates) {
                alert(`Structured entry dates "${data.dates}" could not be parsed. Entry will be added but may not sort correctly.`);
            }
            data.sortDate = sortDate || new Date(0);

            if (!resumeContentData.sections[sectionId]) resumeContentData.sections[sectionId] = [];

            if (editingContext && editingContext.sectionId === sectionId && editingContext.type === 'structured-entry') {
                resumeContentData.sections[sectionId][editingContext.entryIndex] = data;
            } else {
                resumeContentData.sections[sectionId].push(data);
            }
            populateResumeContent();
            return true;
        }

        function addStructuredEntryForm() {
            const sectionId = document.getElementById('structured-section-select').value;
            if (!sectionId) { alert("Please select a section."); return; }
            const bullets = Array.from(document.querySelectorAll('#structured-bullets .bullet-input')).map(input => input.value).filter(value => value.trim() !== '');
            const data = {
                position: document.getElementById('structured-position').value,
                company: document.getElementById('structured-company').value,
                location: document.getElementById('structured-location').value,
                dates: document.getElementById('structured-dates').value,
                bullets: bullets
            };
            if (!data.position || !data.company || !data.dates) {
                alert("Please fill out Position, Company, and Dates."); return;
            }
            if (data.bullets.length === 0 && !confirm("No bullet points added. Continue?")) return;

            if (addStructuredEntry(sectionId, data)) {
                 cancelEdit('structured'); // Clears form and resets edit mode
            }
        }

        function addListItem(sectionId, text) {
            const section = dynamicSections.find(s => s.id === sectionId);
            if (!section || section.type !== 'list-item') return;
            const sortDate = parseDateForSorting(text);
            if (!sortDate && text.match(/\d{4}/)) { // If text seems to contain a year but wasn't parsed
                 alert(`List item date within "${text}" could not be parsed. Item will be added but may not sort correctly.`);
            }
            const data = { text: text, sortDate: sortDate || new Date(0) };

            if (!resumeContentData.sections[sectionId]) resumeContentData.sections[sectionId] = [];

            if (editingContext && editingContext.sectionId === sectionId && editingContext.type === 'list-item') {
                resumeContentData.sections[sectionId][editingContext.entryIndex] = data;
            } else {
                resumeContentData.sections[sectionId].push(data);
            }
            populateResumeContent();
            return true;
        }

        function addListItemForm() {
            const sectionId = document.getElementById('list-section-select').value;
            if (!sectionId) { alert("Please select a section."); return; }
            const text = document.getElementById('list-item-text').value.trim();
            if (!text) { alert("Please enter list item text."); return; }
            if (addListItem(sectionId, text)) {
                cancelEdit('list'); // Clears form and resets edit mode
            }
        }

        function addBulletInput(containerId) {
            const container = document.getElementById(containerId);
            const feedbackElement = container.querySelector('.bullet-length-feedback');
            const div = document.createElement('div');
            div.classList.add('bullet-item');
            const input = document.createElement('input');
            input.type = 'text';
            input.classList.add('bullet-input');
            input.placeholder = 'Enter bullet point';
            input.addEventListener('input', function() { checkBulletLength(this); });
            const removeButton = document.createElement('button');
            removeButton.classList.add('remove-bullet-button');
            removeButton.textContent = 'x';
            removeButton.type = 'button';
            removeButton.onclick = function() {
                div.remove();
                const firstInput = container.querySelector('.bullet-input');
                if (firstInput) checkBulletLength(firstInput); else if(feedbackElement) feedbackElement.classList.remove('show');
            };
            div.appendChild(input);
            div.appendChild(removeButton);
            container.insertBefore(div, feedbackElement);
        }
        function removeBulletItem(buttonElement) {
             const bulletItemDiv = buttonElement.closest('.bullet-item');
             const container = bulletItemDiv.closest('.bullet-inputs');
             bulletItemDiv.remove();
             const remainingInputs = container.querySelectorAll('.bullet-input');
             if (remainingInputs.length > 0) checkBulletLength(remainingInputs[0]);
             else container.querySelector('.bullet-length-feedback')?.classList.remove('show');
        }

        // --- Entry & Bullet Interaction in Resume Preview ---
        function handleResumeInteraction(event) {
            const target = event.target;
            const entryElement = target.closest('.job-entry, .list-entry-item'); // Common class for entries

            // Handle Edit/Remove Entry
            if (target.classList.contains('entry-control-button') && entryElement) {
                const sectionId = entryElement.dataset.sectionId;
                const entryIndex = parseInt(entryElement.dataset.entryIndex);
                const action = target.dataset.action;

                if (action === 'edit') {
                    loadEntryForEditing(sectionId, entryIndex);
                } else if (action === 'remove') {
                    if (confirm('Are you sure you want to remove this entry?')) {
                        removeResumeEntry(sectionId, entryIndex);
                    }
                }
            }
            // Handle Remove Bullet from Preview
            else if (target.classList.contains('bullet-remove-btn')) {
                const structuredEntryElement = target.closest('.job-entry'); // Bullets are only in structured entries
                const sectionId = structuredEntryElement.dataset.sectionId;
                const entryIndex = parseInt(structuredEntryElement.dataset.entryIndex);
                const bulletIndex = parseInt(target.dataset.bulletIndex);
                 if (confirm('Are you sure you want to remove this bullet?')) {
                    removeResumeBullet(sectionId, entryIndex, bulletIndex);
                }
            }
            // Handle Click Bullet Text to Edit Parent Entry
            else if (target.classList.contains('bullet-text')) {
                const structuredEntryElement = target.closest('.job-entry');
                if (structuredEntryElement) {
                    const sectionId = structuredEntryElement.dataset.sectionId;
                    const entryIndex = parseInt(structuredEntryElement.dataset.entryIndex);
                    loadEntryForEditing(sectionId, entryIndex);
                    // Optional: scroll to the form or highlight it
                    document.getElementById('add-structured-entry-section').scrollIntoView({ behavior: 'smooth' });

                }
            }
        }

        function loadEntryForEditing(sectionId, entryIndex) {
            const section = dynamicSections.find(s => s.id === sectionId);
            if (!section) return;
            const entryData = resumeContentData.sections[sectionId][entryIndex];
            if (!entryData) return;

            editingContext = { sectionId, entryIndex, type: section.type };

            if (section.type === 'education-entry') {
                document.getElementById('edu-section-select').value = sectionId;
                document.getElementById('edu-degree').value = entryData.degree || '';
                document.getElementById('edu-institution').value = entryData.institution || '';
                document.getElementById('edu-date').value = entryData.date || '';
                document.getElementById('edu-gpa').value = entryData.gpa || '';
                document.getElementById('edu-expected').value = entryData.expected || '';
                setFormMode('education', true);
            } else if (section.type === 'structured-entry') {
                document.getElementById('structured-section-select').value = sectionId;
                document.getElementById('structured-position').value = entryData.position || '';
                document.getElementById('structured-company').value = entryData.company || '';
                document.getElementById('structured-location').value = entryData.location || '';
                document.getElementById('structured-dates').value = entryData.dates || '';

                const bulletsContainer = document.getElementById('structured-bullets');
                // Clear existing bullet inputs except label and guide
                const itemsToKeep = bulletsContainer.querySelectorAll('label, .bullet-guide, .bullet-length-feedback');
                bulletsContainer.innerHTML = ''; // Clear all
                itemsToKeep.forEach(item => bulletsContainer.appendChild(item.cloneNode(true))); // Re-add label, guide, feedback


                (entryData.bullets || []).forEach(bulletText => {
                    addBulletInput('structured-bullets'); // Adds a new blank bullet input
                    const newBulletInput = bulletsContainer.querySelector('.bullet-item:last-child .bullet-input');
                    if (newBulletInput) newBulletInput.value = bulletText; // Populate it
                });
                // If no bullets in data, ensure at least one empty input exists (addBulletInput might need adjustment or call it once if no bullets)
                if (!entryData.bullets || entryData.bullets.length === 0) {
                    addBulletInput('structured-bullets');
                }

                setFormMode('structured', true);
            } else if (section.type === 'list-item') {
                document.getElementById('list-section-select').value = sectionId;
                document.getElementById('list-item-text').value = entryData.text || '';
                setFormMode('list', true);
            }
             // Scroll to the relevant form
            document.getElementById(`add-${section.type}-section`).scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function removeResumeEntry(sectionId, entryIndex) {
            if (resumeContentData.sections[sectionId] && resumeContentData.sections[sectionId][entryIndex]) {
                resumeContentData.sections[sectionId].splice(entryIndex, 1);
                populateResumeContent();
            }
        }

        function removeResumeBullet(sectionId, entryIndex, bulletIndex) {
            const entry = resumeContentData.sections[sectionId]?.[entryIndex];
            if (entry && entry.bullets && entry.bullets[bulletIndex] !== undefined) {
                entry.bullets.splice(bulletIndex, 1);
                populateResumeContent();
            }
        }

        // --- Populate Resume Content into Rendered Sections ---
        function populateResumeContent() {
             dynamicSections.forEach(section => {
                 const contentDiv = document.getElementById(`content-${section.id}`);
                 if (!contentDiv) return;
                 contentDiv.innerHTML = '';
                 let entries = resumeContentData.sections[section.id] || [];

                 if (['education-entry', 'structured-entry', 'list-item'].includes(section.type)) {
                     entries.sort((a, b) => {
                         const dateA = a.sortDate instanceof Date ? a.sortDate : new Date(0);
                         const dateB = b.sortDate instanceof Date ? b.sortDate : new Date(0);
                         return dateB.getTime() - dateA.getTime();
                     });
                 }

                 entries.forEach((entry, index) => {
                    const entryControlsHtml = `
                        <div class="entry-controls">
                            <button class="entry-control-button" data-action="edit" title="Edit Entry">✏️</button>
                            <button class="entry-control-button" data-action="remove" title="Remove Entry">❌</button>
                        </div>`;

                     switch (section.type) {
                         case 'education-entry':
                         case 'structured-entry': // Combined for general structure
                             const jobEntryDiv = document.createElement('div');
                             jobEntryDiv.classList.add('job-entry');
                             jobEntryDiv.dataset.sectionId = section.id;
                             jobEntryDiv.dataset.entryIndex = index;
                             jobEntryDiv.innerHTML += entryControlsHtml; // Prepend or append carefully

                             let titleHtml = '', locationHtml = '', detailsHtml = '';
                             if (section.type === 'education-entry') {
                                 titleHtml = `<span>${processBolding(entry.degree || '')}</span><span>${processBolding(entry.date || '')}</span>`;
                                 locationHtml = `<span>${processBolding(entry.institution || '')}</span><span>${processBolding(entry.gpa ? 'GPA: ' + entry.gpa : '')}</span>`;
                                 if (entry.expected) detailsHtml = `<p>${processBolding(entry.expected)}</p>`;
                             } else { // structured-entry
                                 titleHtml = `<span>${processBolding(entry.position || '')}</span><span>${processBolding(entry.dates || '')}</span>`;
                                 locationHtml = `<span>${processBolding(entry.company || '')}</span><span>${processBolding(entry.location || '')}</span>`;
                                 if (entry.bullets && entry.bullets.length > 0) {
                                     const ul = document.createElement('ul');
                                     entry.bullets.forEach((bulletText, bulletIdx) => {
                                         const li = document.createElement('li');
                                         const span = document.createElement('span');
                                         span.classList.add('bullet-text');
                                         span.innerHTML = processBolding(bulletText);
                                         li.appendChild(span);
                                         // Add remove button for this bullet
                                         const removeBulletBtn = document.createElement('span');
                                         removeBulletBtn.classList.add('bullet-remove-btn');
                                         removeBulletBtn.innerHTML = '&times;'; // 'x'
                                         removeBulletBtn.dataset.bulletIndex = bulletIdx;
                                         removeBulletBtn.title = "Remove bullet";
                                         li.appendChild(removeBulletBtn);
                                         ul.appendChild(li);
                                     });
                                     detailsHtml = ul.outerHTML;
                                 }
                             }

                             jobEntryDiv.innerHTML += `<div class="job-title">${titleHtml}</div><div class="location">${locationHtml}</div>${detailsHtml}`;
                             contentDiv.appendChild(jobEntryDiv);
                             break;

                         case 'paragraph':
                              const paragraphText = entry || ''; // Paragraphs are stored as single string in array
                              if (paragraphText) {
                                  const p = document.createElement('p');
                                  p.innerHTML = processBolding(paragraphText);
                                  contentDiv.appendChild(p);
                              }
                             break;

                         case 'list-item':
                             const listItemWrapper = document.createElement('div');
                             listItemWrapper.classList.add('list-entry-item'); // New class for consistency and controls
                             listItemWrapper.dataset.sectionId = section.id;
                             listItemWrapper.dataset.entryIndex = index;
                             listItemWrapper.innerHTML = entryControlsHtml;

                             const li = document.createElement('li');
                             li.innerHTML = processBolding(entry.text || '');
                             // For list items, the content itself is the li.
                             // We might need to rethink how controls are added or if list items are wrapped.
                             // For now, let's assume the outer 'ul' is already there.
                             const ulForList = contentDiv.querySelector('ul') || contentDiv.appendChild(document.createElement('ul'));
                             listItemWrapper.appendChild(li); // Add the li to our wrapper
                             ulForList.appendChild(listItemWrapper); // Add wrapper to UL
                             break;
                     }
                 });
             });
        }


        // --- Initial Setup ---
        function initializeResume() {
            dynamicSections = [
                { id: 'education', title: 'Education', type: 'education-entry' },
                { id: 'technical-skills', title: 'Technical Skills', type: 'paragraph' },
                { id: 'experience', title: 'Experience', type: 'structured-entry' },
                { id: 'extracurricular', title: 'Extracurricular Activities', type: 'list-item' }
            ];
            dynamicSections.forEach(section => { resumeContentData.sections[section.id] = []; });

            renderResumeSections();

            document.getElementById('name').value = 'Sara Sadek';
            document.getElementById('address').value = 'Rancho Santa Margarita, CA 92688';
            document.getElementById('email').value = 'EBYEYMCIIcoaoL@gmail.com';
            document.getElementById('phone').value = '(310) 595-0876';
            document.getElementById('linkedin').value = 'https://www.linkedin.com/in/sara-ayoub-sadek-630b55168';
            updateHeader();

            addEducationEntry('education', {
                 degree: 'Bachelor of Science in Biology and Bachelor of Science in Computer Science',
                 institution: 'California State University, Fullerton', date: 'May 2025',
                 gpa: '3.45', expected: 'Expected Graduation: May 2025'
            });
            setParagraphContent('technical-skills', 'Microscopy, Aseptic Technique, Micropipetting, Python, Bash, C++, Data Analysis.');

            const defaultExperienceEntries = [
                 { position: 'Crew', company: 'Chipotle', location: 'RSM, CA', dates: 'August 2023 - Present', bullets: ['Ensured high order accuracy...', 'Utilized the cash register...'] },
                 { position: 'SI Leader (CS)', company: 'CSUF', location: 'Fullerton, CA', dates: 'August 2022 - Present', bullets: ['Tailored communication strategies...', 'Boosted student performance...'] },
                 { position: 'Supplemental Instruction Leader (Biology)', company: 'CSUF', location: 'Fullerton, CA', dates: 'August 2019 - May 2022', bullets: ['Facilitated 2 weekly SI sessions...', 'Supported increased course pass rates...'] }
            ];
            defaultExperienceEntries.forEach(entry => addStructuredEntry('experience', entry));

            const defaultExtracurricularItems = [
                 'STEM Advantage Scholar | January 2022 – Present',
                 'CSUF Chapter of ACM Member | August 2022 – May 2023'
            ];
            defaultExtracurricularItems.forEach(itemText => addListItem('extracurricular', itemText));

            document.querySelectorAll('#structured-bullets .bullet-input').forEach(input => {
                input.addEventListener('input', function() { checkBulletLength(this); });
                checkBulletLength(input);
             });

            populateSectionDropdowns();
            renderSectionRemovalList();

            // Add main event listener for resume interactions
            document.getElementById('resume-sections').addEventListener('click', handleResumeInteraction);
        }

        function clearResumeContent() {
             for (const sectionId in resumeContentData.sections) {
                 resumeContentData.sections[sectionId] = [];
             }
             document.getElementById('resume-name').textContent = '';
             document.getElementById('resume-contact').textContent = '';
             document.getElementById('resume-linkedin').href = '#';
             document.getElementById('resume-linkedin').textContent = '';
             populateResumeContent();
             cancelEdit('education'); cancelEdit('structured'); cancelEdit('list'); // Reset any active edit forms
         }

        document.addEventListener('DOMContentLoaded', initializeResume);

    </script>
    <script>
        // Header specific JS - kept separate for clarity
        function toggleHeaderVisibility() {
            const visible = document.getElementById("toggleHeader").checked;
            const header = document.getElementById("resume-header");
            if (header) header.style.display = visible ? "block" : "none";
        }
        function updateHeader() {
            const name = document.getElementById("name").value;
            const address = document.getElementById("address").value;
            const email = document.getElementById("email").value;
            const phone = document.getElementById("phone").value;
            const linkedin = document.getElementById("linkedin").value;

            document.getElementById("resume-name").textContent = name;
            document.getElementById("resume-contact").textContent = `${address} | ${email} | ${phone}`;
            const link = document.getElementById("resume-linkedin");
            link.href = linkedin;
            link.textContent = linkedin;

            // Also store in resumeContentData for consistency if needed, though header isn't "dynamic" in the same way
            resumeContentData.header = { name, address, email, phone, linkedin };
        }
        document.addEventListener("DOMContentLoaded", () => {
            // updateHeader is called in initializeResume, so not strictly needed here again unless initializeResume order changes
            toggleHeaderVisibility();
        });
</script>
</body>
</html>
