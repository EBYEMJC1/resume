<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Resume Builder</title>
    <style>
        /* --- Builder Layout Styles --- */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            line-height: 1.2; /* Slightly increased for form readability */
            font-size: 14px; /* Increased for form readability */
            display: flex; /* Use flexbox for side-by-side layout */
            min-height: 100vh; /* Ensure full height */
        }
        .builder-container {
            display: flex;
            width: 100%;
            max-width: 1400px; /* Allow more width for side-by-side */
            margin: 0 auto;
            padding: 10px;
            box-sizing: border-box;
        }
        .input-area {
            width: 40%; /* Allocate more width for input forms */
            padding-right: 20px;
            overflow-y: auto; /* Allow scrolling in input area */
            box-sizing: border-box;
        }
        .resume-area {
            width: 60%; /* Allocate width for resume preview */
            border-left: 1px solid #ccc;
            padding-left: 20px;
            box-sizing: border-box;
            overflow-y: auto; /* Allow scrolling in resume area */
        }

        /* Style for input sections */
        .input-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .input-section h3 {
            margin-top: 0;
            margin-bottom: 10px;
            border-bottom: 1px dashed #ccc;
            padding-bottom: 5px;
        }
         .input-section label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 12px; /* Smaller label font */
        }
         .input-section input[type="text"],
        .input-section input[type="email"],
        .input-section input[type="tel"],
        .input-section textarea,
         .input-section select {
            width: calc(100% - 12px); /* Adjust width for padding */
            padding: 5px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 3px;
            font-size: 12px;
        }
        .input-section textarea {
            resize: vertical;
        }

        .input-section button {
            display: inline-block;
            background-color: #007bff;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 5px;
        }
        .input-section button:hover {
            background-color: #0056b3;
        }
         .input-section .remove-button {
             background-color: #dc3545;
             margin-left: 5px;
         }
         .input-section .remove-button:hover {
             background-color: #c82333;
         }


        .bullet-inputs {
            margin-top: 10px;
            padding: 10px;
            border: 1px dashed #ccc;
            border-radius: 3px;
            background-color: #fff;
        }
         .bullet-inputs label {
             font-weight: normal;
         }
        .bullet-inputs input[type="text"] {
            margin-bottom: 5px;
        }
        .bullet-inputs .add-bullet-button {
            background-color: #28a745;
            margin-right: 5px;
        }
         .bullet-inputs .add-bullet-button:hover {
             background-color: #218838;
         }
         .bullet-inputs .remove-bullet-button {
              background-color: #6c757d;
              margin-left: 5px;
              padding: 2px 5px;
              font-size: 10px;
              height: 24px;
              vertical-align: bottom;
         }
         .bullet-inputs .remove-bullet-button:hover {
              background-color: #5a6268;
         }

        .bullet-guide {
            font-size: 10px;
            color: #555;
            margin-bottom: 10px;
        }

        #section-remove-list {
            list-style: none;
            padding: 0;
            margin-top: 10px;
        }
        #section-remove-list li {
            margin-bottom: 5px;
            padding: 5px;
            border: 1px solid #eee;
            background-color: #fff;
            display: flex;
            justify-content: space-between;
            align-items: center;
             font-size: 12px;
        }
         #section-remove-list li button {
             margin-top: 0;
             padding: 2px 8px;
         }


        /* --- Resume Display Styles (Optimized for tightness) --- */
        .resume-area .container {
            max-width: 100%; /* Use full width of the resume-area */
            margin: 0; /* Remove auto margin */
            padding: 0; /* Remove padding, it's on the resume-area */
            font-size: 11px; /* Keep original resume font size */
            line-height: 1.1; /* Keep tight line height */
        }
         /* Base styles for dynamically added sections */
        .resume-section {
            margin-top: 10px; /* Consistent spacing between sections */
        }
        .resume-section .section-title {
            font-weight: bold;
            font-size: 13px;
            margin-top: 0; /* Margin handled by .resume-section */
            border-bottom: 1px solid #000;
            padding-bottom: 2px;
            margin-bottom: 4px; /* Space between title and content */
        }
        .resume-area .header {
            text-align: center;
            margin-bottom: 6px;
        }
        .resume-area .header h1 {
            margin: 0;
            font-size: 16px;
        }
        .resume-area .header p {
            margin: 1px 0;
            font-size: 11px;
        }

        /* Styles specific to content types within sections */
         .resume-section .section-content .job-entry { /* Wrapper for structured entries */
            /* Use margin-top here instead of on job-title to handle spacing between entries */
            margin-top: 8px; /* Space between structured job/experience entries */
         }
         .resume-section .section-content .job-entry:first-child {
             margin-top: 0; /* No extra space for the first entry after the title */
         }


         .resume-section .section-content .job-title { /* Education/Experience Structure */
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            margin-bottom: 0;
            margin-top: 0; /* Margin moved to .job-entry wrapper */
        }
        .resume-section .section-content .location { /* Education/Experience Structure */
            font-style: italic;
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            margin-top: 0;
            margin-bottom: 2px;
        }
        .resume-section .section-content ul { /* Experience/List Structure */
            list-style-type: disc;
            margin-left: 10px;
            font-size: 11px;
            padding-left: 5px;
            margin-top: 0;
            margin-bottom: 0;
        }
        .resume-section .section-content li { /* List items */
             margin-bottom: 1px;
        }
        .resume-section .section-content li:last-child {
            margin-bottom: 0;
        }
        .resume-section .section-content p { /* Skills/Paragraph Structure */
            margin: 1px 0;
            margin-top: 3px; /* Space after title */
        }


         /* --- Print Styles --- */
         @media print {
             body {
                 font-size: 10px; /* Slightly smaller base font for print */
                 line-height: 1; /* Even tighter line height for print */
                 display: block; /* Disable flexbox layout for printing */
             }
             .builder-container {
                 display: block; /* Disable flexbox */
                 width: 100%;
                 max-width: 100%;
                 padding: 0;
                 margin: 0;
             }
             .input-area {
                 display: none; /* Hide the input forms when printing */
             }
             .resume-area {
                 width: 100%; /* Resume takes full width */
                 border-left: none;
                 padding-left: 0;
                 overflow-y: visible; /* Disable scrolling */
             }
             .resume-area .container {
                 font-size: 10px; /* Apply smaller font size within resume content */
                 line-height: 1; /* Apply tighter line height within resume content */
             }
             /* Re-apply tighter margins/padding for print */
             .resume-area .header { margin-bottom: 4px; }
             .resume-area .header p { margin: 0; }

             .resume-section { margin-top: 8px; } /* Tighter section spacing */
             .resume-section .section-title { margin-bottom: 2px; padding-bottom: 1px;}

             .resume-section .section-content .job-entry { margin-top: 6px;} /* Tighter space between structured entries */
             .resume-section .section-content .job-entry:first-child { margin-top: 0;}

             .resume-section .section-content .job-title { margin-top: 2px; margin-bottom: 0; }
             .resume-section .section-content .location { margin-top: 0; margin-bottom: 1px; }
             .resume-section .section-content ul { margin-left: 8px; padding-left: 4px; margin-top: 0; margin-bottom: 0; }
             .resume-section .section-content li { margin-bottom: 0; } /* Remove space between list items */
             .resume-section .section-content p { margin: 0; margin-top: 2px;}


             /* Ensure elements don't break across pages where possible */
             .resume-section, .resume-section .section-content .job-entry {
                 page-break-inside: avoid; /* Avoid breaking inside these blocks if possible */
             }
         }

    </style>
</head>
<body>
    <div class="builder-container">
        <div class="input-area">
            <h2>Resume Builder</h2>

            <div class="input-section">
                <h3>Header Info</h3>
                <label for="name">Name:</label><input type="text" id="name" value="Sara Sadek">
                <label for="address">Address:</label><input type="text" id="address" value="Rancho Santa Margarita, CA 92688">
                <label for="email">Email:</label><input type="email" id="email" value="EBYEYMCIIcoaoL@gmail.com">
                <label for="phone">Phone:</label><input type="tel" id="phone" value="(310) 595-0876">
                <label for="linkedin">LinkedIn URL:</label><input type="text" id="linkedin" value="https://www.linkedin.com/in/sara-ayoub-sadek-630b55168">
                <button onclick="updateHeader()">Update Header</button>
            </div>

            <div class="input-section">
                <h3>Section Management</h3>
                 <label for="new-section-title">New Section Title:</label>
                 <input type="text" id="new-section-title" placeholder="e.g. Projects, Awards">
                 <label for="new-section-type">Section Type:</label>
                 <select id="new-section-type">
                     <option value="structured-entry">Structured Entry (Like Experience)</option>
                     <option value="list-item">List Item (Like Extracurricular)</option>
                     <option value="paragraph">Paragraph (Like Skills)</option>
                     <option value="education-entry">Education Entry</option>
                 </select>
                <button onclick="addSection()">Add New Section</button>

                <h4>Remove Sections</h4>
                <ul id="section-remove-list">
                    <!-- Removable sections will be listed here by JS -->
                </ul>
                 <p style="font-size: 10px; color:#555; margin-top: 10px;">Initial sections (Education, Skills, Experience, Extracurricular) cannot be removed here.</p>
            </div>

            <div class="input-section" id="add-education-entry-section">
                <h3>Add Education Entry</h3>
                 <label for="edu-section-select">Select Section:</label>
                 <select id="edu-section-select" class="section-select"></select>
                <label for="edu-degree">Degree:</label><input type="text" id="edu-degree" value="Bachelor of Science in Biology and Bachelor of Science in Computer Science">
                <label for="edu-institution">Institution:</label><input type="text" id="edu-institution" value="California State University, Fullerton">
                <label for="edu-date"><span style="color: red;">*</span> End Date:</label><input type="text" id="edu-date" value="May 2025" placeholder="e.g. May 2025, 2023 (Required for sorting)">
                <label for="edu-gpa">GPA:</label><input type="text" id="edu-gpa" value="3.45">
                <label for="edu-expected">Additional Line (e.g., Expected Graduation):</label><input type="text" id="edu-expected" value="Expected Graduation: May 2025">
                 <p style="font-size: 10px; color:#555; margin-top: 5px;">End Date is required for sorting.</p>
                <button onclick="addEducationEntryForm()">Add Entry</button>
            </div>

             <div class="input-section" id="add-skills-section">
                <h3>Add/Set Paragraph Content</h3>
                 <label for="para-section-select">Select Section:</label>
                 <select id="para-section-select" class="section-select"></select>
                <label for="skills-content">Paragraph Content:</label>
                <textarea id="skills-content" rows="3">Microscopy, Aseptic Technique, Micropipetting, Spectrophotometry, Gel Electrophoresis, Capsule Stain, Python, Bash, C++ (novice), x86 (novice), Data Analysis, Procedural Adherence, Customer Service, Communication.</textarea>
                 <p style="font-size: 10px; color:#555; margin-top: 5px;">Paragraph sections are not sorted by date.</p>
                <button onclick="setParagraphContentForm()">Set Content</button>
            </div>

            <div class="input-section" id="add-structured-entry-section">
                <h3>Add Structured Entry (e.g., Experience, Projects)</h3>
                 <label for="structured-section-select">Select Section:</label>
                 <select id="structured-section-select" class="section-select"></select>
                <label for="structured-position">Position/Title:</label><input type="text" id="structured-position">
                <label for="structured-company">Company:</label><input type="text" id="structured-company">
                <label for="structured-location">Location:</label><input type="text" id="structured-location">
                <label for="structured-dates"><span style="color: red;">*</span> Dates:</label><input type="text" id="structured-dates" placeholder="e.g. Aug 2023 - Present, 2022 - 2023 (Required for sorting)">

                <div class="bullet-inputs" id="structured-bullets">
                    <label>Details/Bullets:</label>
                     <div class="bullet-guide">Use **text** for bolding. Click "Add Bullet" for more lines.</div>
                    <div><input type="text" class="bullet-input" placeholder="Enter detail or leave blank"></div>
                </div>
                <button class="add-bullet-button" onclick="addBulletInput('structured-bullets')">Add Another Bullet</button>
                 <p style="font-size: 10px; color:#555; margin-top: 5px;">Dates are required for sorting.</p>
                <button onclick="addStructuredEntryForm()">Add Entry</button>
            </div>

             <div class="input-section" id="add-list-item-section">
                <h3>Add List Item (e.g., Activities, Awards)</h3>
                 <label for="list-section-select">Select Section:</label>
                 <select id="list-section-select" class="section-select"></select>
                <label for="list-item-text"><span style="color: red;">*</span> List Item Text:</label>
                <textarea id="list-item-text" rows="2" placeholder="e.g., STEM Advantage Scholar | Jan 2022 – Present (Include date for sorting)"></textarea>
                 <p style="font-size: 10px; color:#555; margin-top: 5px;">Include a date in the text (e.g., Jan 2022, 2023) for sorting to work.</p>
                <button onclick="addListItemForm()">Add Item</button>
            </div>

             <div class="input-section">
                 <h3>Reset/Clear</h3>
                 <button onclick="clearResumeContent()">Clear All Dynamic Content</button>
                 <button onclick="location.reload()">Reset Builder (Clear All)</button>
             </div>


        </div>

        <div class="resume-area">
            <!-- The Resume content will be built here -->
            <div class="container">
                <div class="header">
                    <h1 id="resume-name">Sara Sadek</h1>
                    <p><span id="resume-contact">Rancho Santa Margarita, CA 92688 | EBYEYMCIIcoaoL@gmail.com | (310) 595-0876</span></p>
                    <p><a href="https://www.linkedin.com/in/sara-ayoub-sadek-630b55168" id="resume-linkedin">LinkedIn Profile</a></p>
                </div>
                 <!-- Sections will be dynamically added here -->
                <div id="resume-sections">
                     <!-- Dynamic sections go here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data structure to hold defined sections
        let dynamicSections = [];

        // Store content data separately to avoid losing it when re-rendering structure
        let resumeContentData = {
             header: {},
             sections: {} // Store entries per section id
        };

        // --- Helper Functions ---

        // Helper function to process **text** into <strong>text</strong>
        function processBolding(text) {
            if (typeof text !== 'string') {
                return text; // Return non-string inputs directly
            }
            return text.replace(/\*\*(.*?)\*\*/gi, '<strong>$1</strong>');
        }

         // Helper function to parse date strings for sorting
         function parseDateForSorting(dateStr) {
             if (!dateStr) return null;

             // Handle "Present" - treat as a future date (e.g., year 9999) to ensure it sorts first
             if (dateStr.toLowerCase().includes('present')) {
                  return new Date(9999, 0, 1); // Jan 1, 9999
             }

             // Look for a date range (e.g., "Month Year - Month Year" or "Year - Year")
             const dateRangeMatch = dateStr.match(/(\S+)\s*-\s*(\S+)/);
             if (dateRangeMatch && dateRangeMatch[2]) {
                 // Attempt to parse the END date of the range
                 dateStr = dateRangeMatch[2];
             }

             // Attempt to parse the remaining string
             let parsedDate;

             // Try parsing "Month Year" or "Month, Year"
             parsedDate = new Date(dateStr.replace(',', '') + ' 1'); // Add day 1 to make it a full date string
             if (!isNaN(parsedDate.getTime())) {
                 return parsedDate;
             }

             // Try parsing just "Year"
             parsedDate = new Date(dateStr + '-12-31'); // Use Dec 31 to ensure later sort than Jan 1 of same year
             if (!isNaN(parsedDate.getTime())) {
                 return parsedDate;
             }

             // Try parsing common short formats like "Mon YYYY"
             parsedDate = new Date(dateStr.replace(/(\w+)\s+(\d{4})/, '$1 1, $2'));
              if (!isNaN(parsedDate.getTime())) {
                 return parsedDate;
             }


             // If all attempts fail, return null
             console.warn(`Could not parse date for sorting: "${dateStr}"`);
             return null;
         }

        // --- Resume Rendering ---
        function renderResumeSections() {
            const resumeSectionsDiv = document.getElementById('resume-sections');
            resumeSectionsDiv.innerHTML = ''; // Clear existing sections

            dynamicSections.forEach(section => {
                const sectionDiv = document.createElement('div');
                sectionDiv.classList.add('resume-section');
                sectionDiv.id = `resume-section-${section.id}`; // Add ID for easier targeting

                const titleDiv = document.createElement('div');
                titleDiv.classList.add('section-title');
                titleDiv.textContent = section.title;

                const contentDiv = document.createElement('div');
                contentDiv.classList.add('section-content');
                contentDiv.id = `content-${section.id}`; // Assign ID to content div for targeting

                 // Add initial structure based on type if needed (e.g., empty ul for list types)
                 // Content will be populated later into this structure
                 if (section.type === 'list-item' || section.type === 'extracurricular') {
                     const ul = document.createElement('ul');
                     contentDiv.appendChild(ul);
                 }


                sectionDiv.appendChild(titleDiv);
                sectionDiv.appendChild(contentDiv);
                resumeSectionsDiv.appendChild(sectionDiv);
            });
            // After rendering structure, re-populate content
            populateResumeContent();
        }

        // --- Populate Dropdowns in Input Forms ---
        function populateSectionDropdowns() {
            const sectionSelects = document.querySelectorAll('.section-select');

            sectionSelects.forEach(select => {
                const currentSelectedId = select.value; // Remember selection
                select.innerHTML = ''; // Clear existing options

                let relevantSections = [];
                // Determine which sections are relevant for this dropdown based on its ID
                 if (select.id === 'edu-section-select') {
                    relevantSections = dynamicSections.filter(s => s.type === 'education-entry');
                 } else if (select.id === 'para-section-select') {
                    relevantSections = dynamicSections.filter(s => s.type === 'paragraph');
                 } else if (select.id === 'structured-section-select') {
                    relevantSections = dynamicSections.filter(s => s.type === 'structured-entry');
                 } else if (select.id === 'list-section-select') {
                    relevantSections = dynamicSections.filter(s => s.type === 'list-item');
                 }

                if (relevantSections.length === 0) {
                    select.innerHTML = '<option value="">No sections available</option>';
                    select.disabled = true;
                } else {
                    select.disabled = false;
                    relevantSections.forEach(section => {
                        const option = document.createElement('option');
                        option.value = section.id;
                        option.textContent = section.title;
                        select.appendChild(option);
                    });
                     // Restore previous selection if possible
                     if (currentSelectedId && relevantSections.some(s => s.id === currentSelectedId)) {
                         select.value = currentSelectedId;
                     } else {
                         // If previous selection invalid or not found, default to the first option
                         select.value = relevantSections[0].id;
                     }
                }
            });
        }

        // --- Section Management (Add/Remove) ---
        function addSection() {
            const titleInput = document.getElementById('new-section-title');
            const typeSelect = document.getElementById('new-section-type');
            const title = titleInput.value.trim();
            const type = typeSelect.value;

            if (!title) {
                alert("Please enter a section title.");
                return;
            }

            // Generate a unique ID (lowercase, hyphenated)
            const baseId = title.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, ''); // Basic sanitization
            let sectionId = baseId || 'new-section'; // Ensure ID is not empty
            let counter = 1;
             const initialSectionIds = ['education', 'technical-skills', 'experience', 'extracurricular']; // Prevent conflicts with initial IDs

            while (dynamicSections.some(s => s.id === sectionId) || initialSectionIds.includes(sectionId)) {
                sectionId = `${baseId}-${counter++}`;
            }


            dynamicSections.push({ id: sectionId, title: title, type: type }); // Add to our data structure (entries will be added to resumeContentData)
             resumeContentData.sections[sectionId] = []; // Initialize content array for the new section


            renderResumeSections(); // Re-render the resume structure
            populateSectionDropdowns(); // Update dropdowns
            renderSectionRemovalList(); // Update the remove list

            // Clear form
            titleInput.value = '';
        }

        function renderSectionRemovalList() {
            const removeList = document.getElementById('section-remove-list');
            removeList.innerHTML = ''; // Clear list

            const initialSectionIds = ['education', 'technical-skills', 'experience', 'extracurricular']; // Prevent removing these via UI

            dynamicSections.forEach(section => {
                 if (initialSectionIds.includes(section.id)) {
                    // Skip initial sections
                     return;
                }

                const li = document.createElement('li');
                li.textContent = section.title;
                const removeButton = document.createElement('button');
                removeButton.classList.add('remove-button');
                removeButton.textContent = 'Remove';
                removeButton.onclick = () => removeSection(section.id);
                li.appendChild(removeButton);
                removeList.appendChild(li);
            });
        }

        function removeSection(id) {
             // Find the index of the section with the given ID
             const index = dynamicSections.findIndex(section => section.id === id);

             if (index !== -1) {
                 // Remove the section from the array
                 dynamicSections.splice(index, 1);

                 // Remove its content data
                 delete resumeContentData.sections[id];

                 // Re-render everything
                 renderResumeSections();
                 populateSectionDropdowns();
                 renderSectionRemovalList(); // Update the remove list
             }
        }

        // --- Content Management (Add Entries to Sections) ---

        // Add Education Entry
        function addEducationEntry(sectionId, data) {
             const section = dynamicSections.find(s => s.id === sectionId);
             if (!section || section.type !== 'education-entry') {
                  console.error(`Section ${sectionId} not found or not of type 'education-entry'`);
                  return;
             }

             // Add the sortable date to the data object
             data.sortDate = parseDateForSorting(data.date);

             if (!resumeContentData.sections[sectionId]) {
                 resumeContentData.sections[sectionId] = [];
             }
             resumeContentData.sections[sectionId].push(data);
             populateResumeContent(); // Re-render content (which now includes sorting)
        }

         function addEducationEntryForm() {
             const sectionId = document.getElementById('edu-section-select').value;
             if (!sectionId) { alert("Please select a section."); return; }

             const degree = document.getElementById('edu-degree').value;
             const institution = document.getElementById('edu-institution').value;
             const date = document.getElementById('edu-date').value; // This is the required field for sorting
             const gpa = document.getElementById('edu-gpa').value;
             const expected = document.getElementById('edu-expected').value;

             if (!degree || !institution || !date) {
                 alert("Please fill out Degree, Institution, and End Date.");
                 return;
             }

             const data = { degree, institution, date, gpa, expected };
             addEducationEntry(sectionId, data);

             // Clear form
             document.getElementById('edu-degree').value = '';
             document.getElementById('edu-institution').value = '';
             document.getElementById('edu-date').value = '';
             document.getElementById('edu-gpa').value = '';
             document.getElementById('edu-expected').value = '';
         }

         // Set Paragraph Content (for skills or custom paragraph sections)
         // This function doesn't involve dates or sorting multiple entries
        function setParagraphContent(sectionId, content) {
            const section = dynamicSections.find(s => s.id === sectionId);
             if (!section || section.type !== 'paragraph') {
                  console.error(`Section ${sectionId} not found or not of type 'paragraph'`);
                  return;
             }
             // Paragraph sections typically only have ONE paragraph
             resumeContentData.sections[sectionId] = [content]; // Store as a single item array
             populateResumeContent(); // Re-render content
        }

        function setParagraphContentForm() {
            const sectionId = document.getElementById('para-section-select').value;
            if (!sectionId) { alert("Please select a section."); return; }

            const content = document.getElementById('skills-content').value;
            setParagraphContent(sectionId, content);

             // Clear form (maybe not desired if user is refining)
             // document.getElementById('skills-content').value = '';
        }

        // Add Structured Entry (for experience or custom structured sections)
         function addStructuredEntry(sectionId, data) {
             const section = dynamicSections.find(s => s.id === sectionId);
             if (!section || section.type !== 'structured-entry') {
                  console.error(`Section ${sectionId} not found or not of type 'structured-entry'`);
                  return;
             }

             // Add the sortable date to the data object
             data.sortDate = parseDateForSorting(data.dates);

             if (!resumeContentData.sections[sectionId]) {
                 resumeContentData.sections[sectionId] = [];
             }
             resumeContentData.sections[sectionId].push(data);
             populateResumeContent(); // Re-render content (which now includes sorting)
         }

         function addStructuredEntryForm() {
             const sectionId = document.getElementById('structured-section-select').value;
             if (!sectionId) { alert("Please select a section."); return; }

             const position = document.getElementById('structured-position').value;
             const company = document.getElementById('structured-company').value;
             const location = document.getElementById('structured-location').value;
             const dates = document.getElementById('structured-dates').value; // This is the required field for sorting
             const bulletInputs = document.querySelectorAll('#structured-bullets .bullet-input');
             const bullets = Array.from(bulletInputs).map(input => input.value).filter(value => value.trim() !== '');

             if (!position || !company || !dates) {
                 alert("Please fill out Position, Company, and Dates.");
                 return;
             }

             const data = { position, company, location, dates, bullets };
             addStructuredEntry(sectionId, data);

             // Clear form
             document.getElementById('structured-position').value = '';
             document.getElementById('structured-company').value = '';
             document.getElementById('structured-location').value = '';
             document.getElementById('structured-dates').value = '';
             const structuredBulletsContainer = document.getElementById('structured-bullets');
              structuredBulletsContainer.innerHTML = `<label>Details/Bullets:</label><div class="bullet-guide">Use **text** for bolding. Click "Add Bullet" for more lines.</div><div><input type="text" class="bullet-input" placeholder="Enter detail or leave blank"></div>`; // Reset bullets
         }


        // Add List Item (for extracurricular or custom list sections)
         function addListItem(sectionId, text) {
             const section = dynamicSections.find(s => s.id === sectionId);
             if (!section || section.type !== 'list-item') {
                  console.error(`Section ${sectionId} not found or not of type 'list-item'`);
                  return;
             }

             // Add the sortable date to the data object (parse from the text)
             // We'll store the list item as an object { text: ..., sortDate: ... }
             const data = { text: text, sortDate: parseDateForSorting(text) };


             if (!resumeContentData.sections[sectionId]) {
                 resumeContentData.sections[sectionId] = [];
             }
             resumeContentData.sections[sectionId].push(data);
             populateResumeContent(); // Re-render content (which now includes sorting)
         }

         function addListItemForm() {
            const sectionId = document.getElementById('list-section-select').value;
            if (!sectionId) { alert("Please select a section."); return; }

            const text = document.getElementById('list-item-text').value.trim();
            if (!text) {
                alert("Please enter list item text.");
                return;
            }

            // Check if text contains something parseable as a date for sorting purposes
            if (!parseDateForSorting(text)) {
                 const confirmAdd = confirm("Warning: Could not find a date in the text for sorting. This item might appear at the end of the section. Continue?");
                 if (!confirmAdd) {
                     return;
                 }
             }

            addListItem(sectionId, text);

            // Clear form
            document.getElementById('list-item-text').value = '';
         }

        // Dynamic Bullet Input Helper (reused)
        function addBulletInput(containerId) {
            const container = document.getElementById(containerId);
             // Find the element *before* the buttons to insert before them
             const addButton = container.parentNode.querySelector('.add-bullet-button'); // Assuming add button is sibling of bullet-inputs div
             const insertBeforeElement = addButton ? addButton : container.lastElementChild; // Insert before add button if found, else last element


            const div = document.createElement('div'); // Wrap input and button
            const input = document.createElement('input');
            input.type = 'text';
            input.classList.add('bullet-input');
            input.placeholder = 'Enter detail or leave blank';

             // Add a small button to remove this bullet input
            const removeButton = document.createElement('button');
            removeButton.classList.add('remove-bullet-button');
            removeButton.textContent = 'x';
            removeButton.type = 'button'; // Prevent form submission
            removeButton.onclick = function() {
                div.remove(); // Remove the wrapper div
            };

            div.appendChild(input);
            div.appendChild(removeButton);
            // Insert the new bullet input div before the add bullet button or at the end
             container.insertBefore(div, insertBeforeElement);
        }


        // --- Populate Resume Content into Rendered Sections ---
        // This function reads the data from resumeContentData, SORTS IT, and builds the HTML inside the section content divs
        function populateResumeContent() {
             dynamicSections.forEach(section => {
                 const contentDiv = document.getElementById(`content-${section.id}`);
                 if (!contentDiv) {
                     console.error(`Content div not found for section: ${section.id}`);
                     return; // Section container not found (shouldn't happen if structure is rendered)
                 }

                 // Clear previous content inside this section's content div
                 contentDiv.innerHTML = '';

                 let entries = resumeContentData.sections[section.id] || [];

                 // --- Sorting Logic ---
                 // Only sort sections that have a sortable type
                 if (['education-entry', 'structured-entry', 'list-item'].includes(section.type)) {
                     entries.sort((a, b) => {
                         const dateA = a.sortDate;
                         const dateB = b.sortDate;

                         // Handle invalid/missing dates: put them at the end
                         if (!dateA && !dateB) return 0; // Both invalid, maintain original relative order
                         if (!dateA) return 1; // A is invalid, put it after B
                         if (!dateB) return -1; // B is invalid, put it after A

                         // Compare valid dates in reverse chronological order (most recent first)
                         return dateB.getTime() - dateA.getTime();
                     });
                 }
                 // --- End Sorting Logic ---


                 // Now render the sorted entries
                 switch (section.type) {
                     case 'education-entry':
                          entries.forEach(entry => {
                             const jobEntryDiv = document.createElement('div'); // Wrap entry for potential print breaking
                             jobEntryDiv.classList.add('job-entry');

                             const jobTitleDiv = document.createElement('div');
                             jobTitleDiv.classList.add('job-title');
                             jobTitleDiv.innerHTML = `<span>${processBolding(entry.degree || '')}</span><span>${processBolding(entry.date || '')}</span>`;

                             const locationDiv = document.createElement('div');
                             locationDiv.classList.add('location');
                             locationDiv.innerHTML = `<span>${processBolding(entry.institution || '')}</span><span>${processBolding(entry.gpa ? 'GPA: ' + entry.gpa : '')}</span>`;

                             jobEntryDiv.appendChild(jobTitleDiv);
                             jobEntryDiv.appendChild(locationDiv);

                             if (entry.expected) {
                                 const p = document.createElement('p');
                                 p.innerHTML = processBolding(entry.expected);
                                 jobEntryDiv.appendChild(p);
                             }
                             contentDiv.appendChild(jobEntryDiv); // Append the wrapped entry
                         });
                         break;

                     case 'paragraph':
                          // Only expect one paragraph entry per section of this type
                          const paragraphText = entries[0] || ''; // Get the single stored item
                          if (paragraphText) {
                              const p = document.createElement('p');
                              p.innerHTML = processBolding(paragraphText);
                              contentDiv.appendChild(p);
                          }
                         break;

                     case 'structured-entry': // Experience, Projects, etc.
                         entries.forEach(entry => {
                              const jobEntryDiv = document.createElement('div'); // Wrap job entry for better print page-breaking
                              jobEntryDiv.classList.add('job-entry');

                              const jobTitleDiv = document.createElement('div');
                              jobTitleDiv.classList.add('job-title');
                              jobTitleDiv.innerHTML = `<span>${processBolding(entry.position || '')}</span><span>${processBolding(entry.dates || '')}</span>`;

                              const locationDiv = document.createElement('div');
                              locationDiv.classList.add('location');
                              locationDiv.innerHTML = `<span>${processBolding(entry.company || '')}</span><span>${processBolding(entry.location || '')}</span>`;

                              jobEntryDiv.appendChild(jobTitleDiv);
                              jobEntryDiv.appendChild(locationDiv);

                              if (entry.bullets && entry.bullets.length > 0) {
                                  const ul = document.createElement('ul');
                                  entry.bullets.forEach(bulletText => {
                                      const li = document.createElement('li');
                                      li.innerHTML = processBolding(bulletText);
                                      ul.appendChild(li);
                                  });
                                  jobEntryDiv.appendChild(ul);
                              }
                              contentDiv.appendChild(jobEntryDiv); // Append the wrapped entry
                         });
                         break;

                     case 'list-item': // Extracurricular, Awards, etc.
                         const ul = contentDiv.querySelector('ul'); // Find the ul already created during structure rendering
                         if (ul) {
                             entries.forEach(entry => { // entry is now an object { text: ..., sortDate: ... }
                                  const li = document.createElement('li');
                                  li.innerHTML = processBolding(entry.text || ''); // Use the original text
                                  ul.appendChild(li);
                             });
                         }
                         break;
                 }
             });
        }


        // --- Initial Setup ---
        function initializeResume() {
            // Define initial sections with unique IDs and types
            dynamicSections = [
                { id: 'education', title: 'Education', type: 'education-entry' },
                { id: 'technical-skills', title: 'Technical Skills', type: 'paragraph' },
                { id: 'experience', title: 'Experience', type: 'structured-entry' },
                { id: 'extracurricular', title: 'Extracurricular Activities', type: 'list-item' }
            ];

            // Initialize content data structure for defined sections
             dynamicSections.forEach(section => {
                 resumeContentData.sections[section.id] = [];
             });

            // Render the basic section structure
            renderResumeSections(); // This will call populateResumeContent() implicitly the first time

            // Populate the initial content based on the default values in the input fields
            // This simulates adding the original resume content using the new data structure/functions

            // Header
            updateHeader(); // Reads default values from inputs and sets resumeContentData.header

            // Education (add the default entry)
             addEducationEntry('education', {
                 degree: document.getElementById('edu-degree').value,
                 institution: document.getElementById('edu-institution').value,
                 date: document.getElementById('edu-date').value, // Make sure default has a date
                 gpa: document.getElementById('edu-gpa').value,
                 expected: document.getElementById('edu-expected').value
             });

            // Technical Skills (set the default content)
             setParagraphContent('technical-skills', document.getElementById('skills-content').value);

            // Experience (Add all default entries)
             const defaultExperienceEntries = [
                 { position: 'Crew', company: 'Chipotle', location: '22245 El Paseo, Rancho Santa Margarita, CA', dates: 'August 2023 - Present', bullets: ['Ensured high order accuracy by implementing a step-by-step confirmation process and verbally verifying item details, consistently limiting errors to fewer than 4 per 5-hour shift', 'Utilized the cash register to charge 10–20 customers per shift, **double-checking totals** to prevent overcharging and **ensuring extras** like cups and chips were included when ordered', 'Fostered safe food consumption by strictly following detailed operational and sanitation protocols during 100% of my closing shifts, reducing potential contamination risks'] },
                 { position: 'Supplemental Instruction Leader (Computer Science)', company: 'CSUF', location: '800 N State College Blvd, Fullerton, CA', dates: 'August 2022 - Present', bullets: ['Tailored communication strategies, incorporating **analogies & rephrasing**, to simplify complex technical concepts related to hybrid x86-64 assembly with C++ enhancing comprehension', 'Boosted student performance by **adapting explanations** through active questioning and observation, leading SI attendees to score 1–1.5x higher than non-attendees'] },
                 { position: 'CREP Student Researcher', company: 'CSUF', location: '800 N State College Blvd, Fullerton, CA', dates: 'August 2022 - May 2023', bullets: ['Managed and **cleaned** a complex health-related dataset (N=62,482) from the Tennessee Cancer Registry for localized malignant breast cancer (LMBC)', 'Reviewed 5 papers on various cancers to **identify demographic and clinical variables** consistently linked to outcomes (e.g., age, marital status, insurance type)', 'Performed quantitative analysis, including **Chi-square tests and multivariate logistic regression**, on cleaned health data'] },
                 { position: 'DIA Jumpstart Student Researcher', company: 'University of Southern California', location: '', dates: 'June 2022 - August 2022', bullets: ['Employed a bash script to process and trim RNA sequencing datasets, using **Seqtk v1.3** removing 5 base pairs iteratively from the 3\' end of reads until a minimum length of 36 bp', 'Explored **read length effect** through use of 12 samples finding that read length from 36 to 76 bp raised HLA caller accuracy from 63% to 77%, except for PHLAT, seq2HLA, and HLAMiner'] },
                  { position: 'CIC-PCUBED', company: 'CSUF', location: '800 N State College Blvd, Fullerton, CA', dates: 'June 2022 - August 2022', bullets: ['Collaborated on a Python project to identify cointegrated stocks for financial analysis'] },
                  { position: 'Supplemental Instruction Leader (Biology)', company: 'CSUF', location: '800 N State College Blvd, Fullerton, CA', dates: 'August 2019 - May 2022', bullets: ['Facilitated 2 weekly SI sessions for BIOL 151, a foundational course covering topics such as cellular structures, metabolic pathways, and gene regulation.', 'Supported increased course pass rates, as students attending SI sessions have an 83% pass rate in gateway courses, compared to 76% for those who do not participate'] },
                  { position: 'ASSURE-US Member', company: 'CSUF', location: '800 N State College Blvd, Fullerton, CA', dates: 'November 2019 - August 2021', bullets: ['Developed a decision tree model using **scikit-learn** in Python to analyze data for viable drug candidates targeting HIV-1 integrase.'] },
                 { position: 'Summer Undergraduate Research Fellowship', company: 'University of Southern California', location: '', dates: 'June 2021 - August 2021', bullets: ['Ran HLA typing pipelines using Bash with OptiType, PHLAT, and seq2HLA on RNA-seq data across six gold standard datasets', 'Estimated allele-level accuracy of 99.4% (OptiType), 95.4% (PHLAT), and 95.9% (seq2HLA) for MHC class I, using the formula: (correct alleles / total alleles) × 100', 'Measured CPU time per sample using Unix time, recording averages of 45.3 min (OptiType), 253 sec (PHLAT), and 6.9 min (seq2HLA)', 'Recorded memory usage via <code>/usr/bin/time -v</code>, with averages of 14.2 GB (OptiType), 9.3 GB (PHLAT), and 0.36 GB (seq2HLA)'] },
                  { position: 'Peer Mentor', company: 'CSUF', location: '800 N State College Blvd, Fullerton, CA', dates: 'August 2018 - December 2018', bullets: ['Provided personalized support to 25 students in the “Think Like Einstein” course by addressing questions and guiding them to campus resources such as Titan Connection, Titan Link, counselors, research opportunities, and professional communication skills'] },
                  { position: 'Orientation Leader', company: 'CSUF', location: '800 N State College Blvd, Fullerton, CA', dates: 'June 2018 - August 2018', bullets: ['Guided diverse groups of new students, presenting essential campus resources and procedures daily to groups of 25-30 students'] }
             ];
             defaultExperienceEntries.forEach(entry => addStructuredEntry('experience', entry));


            // Extracurricular Activities (Add all default entries)
             const defaultExtracurricularItems = [
                 'STEM Advantage Scholar | January 2022 – Present',
                 'CSUF Chapter of ACM Member | August 2022 – May 2023',
                 'Example Older Activity | 2017 - 2018' // Add an older one to test sorting
             ];
             defaultExtracurricularItems.forEach(item => addListItem('extracurricular', item));


            // Update dropdowns and remove list after initial population
            populateSectionDropdowns();
            renderSectionRemovalList();
        }

        // --- Clear Content ---
         function clearResumeContent() {
             // Reset data structures
             dynamicSections = [
                 { id: 'education', title: 'Education', type: 'education-entry' },
                 { id: 'technical-skills', title: 'Technical Skills', type: 'paragraph' },
                 { id: 'experience', title: 'Experience', type: 'structured-entry' },
                 { id: 'extracurricular', title: 'Extracurricular Activities', type: 'list-item' }
             ];
             resumeContentData = {
                 header: {},
                 sections: {}
             };
             // Re-initialize content arrays for default sections
             dynamicSections.forEach(section => {
                 resumeContentData.sections[section.id] = [];
             });


             // Clear rendered sections
             renderResumeSections(); // This also calls populateResumeContent, clearing the view

             // Clear header display
             document.getElementById('resume-name').textContent = '';
             document.getElementById('resume-contact').textContent = '';
             document.getElementById('resume-linkedin').href = '#';
             document.getElementById('resume-linkedin').textContent = '';

             // Clear input forms (optional, location.reload is easier for full reset)
             document.getElementById('name').value = '';
             document.getElementById('address').value = '';
             document.getElementById('email').value = '';
             document.getElementById('phone').value = '';
             document.getElementById('linkedin').value = '';
             document.getElementById('new-section-title').value = '';
             document.getElementById('new-section-type').value = 'structured-entry';
             document.getElementById('edu-degree').value = '';
             document.getElementById('edu-institution').value = '';
             document.getElementById('edu-date').value = '';
             document.getElementById('edu-gpa').value = '';
             document.getElementById('edu-expected').value = '';
             document.getElementById('skills-content').value = '';
             document.getElementById('structured-position').value = '';
             document.getElementById('structured-company').value = '';
             document.getElementById('structured-location').value = '';
             document.getElementById('structured-dates').value = '';
             const structuredBulletsContainer = document.getElementById('structured-bullets');
              structuredBulletsContainer.innerHTML = `<label>Details/Bullets:</label><div class="bullet-guide">Use **text** for bolding. Click "Add Bullet" for more lines.</div><div><input type="text" class="bullet-input" placeholder="Enter detail or leave blank"></div>`;
             document.getElementById('list-item-text').value = '';

             // Update UI elements
             populateSectionDropdowns();
             renderSectionRemovalList();
         }


        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', initializeResume);

    </script>
</body>
</html>
